# 番茄时钟小程序概要设计文档

## 1. 系统架构设计

### 1.1 整体架构

```
┌─────────────────────────────────────┐
│         用户界面层 (UI Layer)        │
│  ┌──────────┐      ┌──────────┐    │
│  │ 主界面   │      │ 任务管理 │    │
│  │ (倒计时) │      │ 界面     │    │
│  └──────────┘      └──────────┘    │
└─────────────────────────────────────┘
              │              │
┌─────────────────────────────────────┐
│       业务逻辑层 (Logic Layer)      │
│  ┌──────────┐      ┌──────────┐    │
│  │ 计时器   │      │ 任务管理 │    │
│  │ 控制器   │      │ 控制器   │    │
│  └──────────┘      └──────────┘    │
└─────────────────────────────────────┘
              │              │
┌─────────────────────────────────────┐
│       数据访问层 (Data Layer)        │
│  ┌──────────┐      ┌──────────┐    │
│  │ 本地存储 │      │ 数据模型 │    │
│  │ 服务     │      │ 定义     │    │
│  └──────────┘      └──────────┘    │
└─────────────────────────────────────┘
```

### 1.2 技术架构

- **前端框架**: uniapp (Vue2)
- **UI组件库**: uview2.0
- **状态管理**: Vue组件data + 本地存储
- **路由管理**: uniapp页面路由
- **数据持久化**: uni.setStorage / uni.getStorage

## 2. 模块设计

### 2.1 功能模块划分

#### 2.1.1 番茄时钟模块
- **功能**: 倒计时显示与控制
- **职责**:
  - 25分钟工作倒计时
  - 5分钟短休息倒计时
  - 开始/暂停/重置控制
  - 循环计时逻辑
  - 完成提醒

#### 2.1.2 任务管理模块
- **功能**: 任务数据的增删改查
- **职责**:
  - 任务列表展示
  - 任务详情展示
  - 任务数据存储管理

#### 2.1.3 数据存储模块
- **功能**: 本地数据持久化
- **职责**:
  - 任务数据存储
  - 任务数据读取
  - 数据格式管理

### 2.2 页面结构

```
pages/
├── index/              # 主页面（番茄时钟）
│   └── index.vue
├── task-list/          # 任务列表页
│   └── task-list.vue
└── task-detail/        # 任务详情页
    └── task-detail.vue
```

## 3. 数据模型设计

### 3.1 任务数据模型

```javascript
Task {
  id: String,              // 任务唯一标识
  title: String,           // 任务标题
  description: String,     // 任务描述
  priority: String,        // 优先级: 'high' | 'medium' | 'low'
  category: String,        // 分类: 'work' | 'study' | 'life'
  tomatoCount: Number,     // 已完成番茄数量
  createTime: Number,      // 创建时间戳
  updateTime: Number      // 更新时间戳
}
```

### 3.2 计时器状态模型

```javascript
TimerState {
  mode: String,            // 模式: 'work' | 'rest'
  duration: Number,        // 总时长（秒）
  remaining: Number,       // 剩余时间（秒）
  isRunning: Boolean,      // 是否运行中
  isPaused: Boolean        // 是否暂停
}
```

### 3.3 存储键设计

```javascript
STORAGE_KEYS = {
  TASK_LIST: 'tomato_clock_task_list',  // 任务列表
  CURRENT_TASK: 'tomato_clock_current_task'  // 当前任务（可选）
}
```

## 4. 核心功能流程

### 4.1 番茄时钟倒计时流程

```
开始
  │
  ├─> 选择模式（工作/休息）
  │
  ├─> 点击开始
  │   │
  │   ├─> 启动定时器
  │   │
  │   ├─> 每秒更新剩余时间
  │   │
  │   ├─> 倒计时结束
  │   │   │
  │   │   ├─> 触发完成提醒
  │   │   │
  │   │   └─> 自动切换模式（循环）
  │   │
  │   ├─> 点击暂停
  │   │   └─> 暂停定时器
  │   │
  │   └─> 点击重置
  │       └─> 重置到初始时间
  │
  └─> 结束
```

### 4.2 任务管理流程

```
任务列表页
  │
  ├─> 加载任务列表
  │   └─> 从本地存储读取
  │
  ├─> 点击任务项
  │   └─> 跳转到任务详情页
  │       │
  │       └─> 展示任务信息
  │
  └─> 返回主界面
      └─> 右上角列表图标
```

## 5. UI/UX设计规范

### 5.1 颜色规范

- **主色调**: 番茄红 `#FF6347`
- **渐变配色**: 
  - 主渐变: `#FF6347` → `#FF8C69`
  - 辅助渐变: `#FFA07A` → `#FFE4E1`
- **文字颜色**:
  - 主文字: `#333333`
  - 次要文字: `#666666`
  - 辅助文字: `#999999`
- **背景色**:
  - 主背景: `#FFFFFF`
  - 卡片背景: `#F8F8F8`

### 5.2 字体规范

- **标题**: 32-40rpx, 加粗
- **正文**: 28-32rpx, 常规
- **辅助文字**: 24-26rpx, 常规
- **倒计时数字**: 120-150rpx, 加粗（科技感字体）

### 5.3 间距规范

- **页面边距**: 30-40rpx
- **组件间距**: 20-30rpx
- **元素间距**: 10-20rpx
- **留白区域**: 60-80rpx

### 5.4 圆角规范

- **按钮圆角**: 50rpx（胶囊型）
- **卡片圆角**: 20-30rpx
- **小元素圆角**: 10-15rpx

### 5.5 交互规范

- **点击反馈**: 轻微缩放或颜色变化
- **页面切换**: 淡入淡出动画
- **加载状态**: 骨架屏或加载动画
- **操作反馈**: Toast提示

## 6. 组件设计

### 6.1 自定义组件

#### 6.1.1 倒计时显示组件
- **名称**: `CountdownDisplay`
- **功能**: 显示倒计时时间，科技感样式
- **Props**: 
  - `time`: 剩余时间（秒）
  - `mode`: 当前模式

#### 6.1.2 控制按钮组件
- **名称**: `ControlButtons`
- **功能**: 开始/暂停/重置按钮组
- **Props**:
  - `isRunning`: 是否运行中
  - `onStart`: 开始回调
  - `onPause`: 暂停回调
  - `onReset`: 重置回调

#### 6.1.3 任务卡片组件
- **名称**: `TaskCard`
- **功能**: 任务列表项展示
- **Props**:
  - `task`: 任务对象
  - `onClick`: 点击回调

### 6.2 uView组件使用

- **图标**: `u-icon`（使用uView内置图标）
- **按钮**: `u-button`
- **卡片**: `u-card` 或自定义卡片
- **标签**: `u-tag`（优先级、类型显示）
- **空状态**: `u-empty`（无任务时）

## 7. 接口设计（本地存储）

### 7.1 任务数据接口

#### 7.1.1 获取任务列表
```javascript
getTaskList(): Array<Task>
```

#### 7.1.2 保存任务列表
```javascript
saveTaskList(tasks: Array<Task>): void
```

#### 7.1.3 获取任务详情
```javascript
getTaskById(id: String): Task | null
```

#### 7.1.4 更新任务
```javascript
updateTask(task: Task): void
```

## 8. 异常处理

### 8.1 数据异常
- 本地存储读取失败：返回空数组或默认值
- 数据格式错误：数据校验和修复

### 8.2 功能异常
- 定时器异常：错误提示和重置
- 页面跳转异常：返回上一页

## 9. 性能优化

### 9.1 渲染优化
- 使用`v-show`替代`v-if`（频繁切换场景）
- 列表使用虚拟滚动（任务较多时）
- 图片懒加载

### 9.2 数据优化
- 本地存储数据压缩
- 定时器及时清理
- 避免内存泄漏

## 10. 安全考虑

### 10.1 数据安全
- 本地存储数据校验
- 防止数据注入

### 10.2 用户体验安全
- 操作确认（删除等危险操作）
- 数据备份提示

